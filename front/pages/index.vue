<script setup lang="ts">
const { $dayjs, $today } = useNuxtApp()
const date = ref($today)
const planDialog = ref()
const calendarDialog = ref()
const plans = ref<Plan[]>([])
const loading = ref(false)

const onUpdated = (plan: Plan) => {
  const index = plans.value.findIndex(({ id }) => plan.id === id)
  if (index === -1) {
    return plans.value.unshift(plan)
  }
  plans.value.splice(index, 1, plan)
}

const onDeleted = function (plan: Plan) {
  const index = plans.value.findIndex(({ id }) => plan.id === id)
  plans.value.splice(index, 1)
}

const loadData = async () => {
  if (loading.value) {
    return
  }
  loading.value = true
  const params = isToday.value ? { today: 1 } : { date: date.value }
  const { data } = await useHttp<PlanResponse>("plans", { params })
  if (data.value) {
    plans.value = data.value.data
  }
  loading.value = false
}

const isToday = computed(() => date.value === $today)
watch(date, () => loadData())
loadData()
</script>
<template>
  <header>
    <v-btn :size="48" icon @click="calendarDialog.open()">
      <v-icon> jo-time-calendar-dates </v-icon>
    </v-btn>
    <div class="text-grey">
      {{ $dayjs(date).format("dddd D MMMM") }}
    </div>
    <v-btn :size="48" icon @click="() => planDialog.open(date)">
      <v-icon> jo-basic-plus </v-icon>
    </v-btn>
  </header>
  <main>
    <PlanList
      :items="plans"
      v-if="!loading"
      :is-today="isToday"
      @edit="(plan) => planDialog.edit(plan)"
    />
  </main>
  <client-only>
    <PlanDialog ref="planDialog" @updated="onUpdated" @deleted="onDeleted" />
    <CalendarDialog ref="calendarDialog" v-model="date" load-events />
  </client-only>
</template>

<!-- 
  ---- 4 Ð°Ð¿Ñ€ÐµÐ»Ñ:
  ÐŸÐ¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾. Ð¯ Ð¾Ñ…ÑƒÐµÐ½ÐµÐ½ Ð² Ñ‚ÐµÐ¾Ñ€Ð¸Ð¸. Ð¯ Ð²ÑÑ‘, Ð±Ð»ÑÑ‚ÑŒ, Ð·Ð½Ð°ÑŽ.
  ÐÐ¾ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ° ÑÑ‚Ñ€Ð°Ð´Ð°ÐµÑ‚. Ð¡Ñ‚Ñ€Ð°Ð´Ð°ÐµÑ‚ Ð¿Ð¸Ð·Ð´ÐµÑ†. Ð—Ð½Ð°ÑŽ, ÐºÐ°Ðº Ð½ÑƒÐ¶Ð½Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ,
  Ð½Ð¾ Ð½Ð¸Ñ…ÑƒÑ Ð½Ðµ Ð´ÐµÐ»Ð°ÑŽ. Ð˜ Ñ‚Ð°Ðº Ð²ÑÐµÐ³Ð´Ð°: Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ÑŒ ÐšÐ¾ÑÑ‚Ðµ,
  Ñ‡Ñ‚Ð¾ Ñ Ð¾Ñ‚Ð¾ÑˆÐµÐ» Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ â€“ Ð½Ð¾ Ð½Ð¸Ñ…ÑƒÑ Ð½Ðµ Ð³Ð¾Ð²Ð¾Ñ€ÑŽ. Ð—Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ,
  Ñ‡Ñ‚Ð¾ Ð¾Ð¿Ð¾Ð·Ð´Ð°ÑŽ Ð¸Ð»Ð¸ Ð½Ðµ Ð¿Ñ€Ð¸Ð´Ñƒ â€“ Ð½Ð¾ Ð½Ð¸Ñ…ÑƒÑ Ð½Ðµ Ð¿Ð¸ÑˆÑƒ. Ð—Ð½Ð°ÑŽ, ÐºÐ°Ðº Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ð¾ÑÑ‚ÑƒÐ¿Ð¸Ñ‚ÑŒ
  Ð² ÐºÐ°ÐºÐ¾Ð¹-Ð½Ð¸Ð±ÑƒÐ´ÑŒ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸Ð¸, Ð·Ð½Ð°ÑŽ Ð½Ð°Ð²ÐµÑ€Ð½ÑÐºÐ°, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ñ‡Ð¸Ñ‚Ð°Ð» Ð² ÐºÐ½Ð¸Ð³Ðµ â€“ Ð½Ð¾
  Ð½Ð¸Ñ…ÑƒÑ Ð½Ðµ ÑÐ»ÐµÐ´ÑƒÑŽ. ÐŸÐ ÐÐšÐ¢Ð˜ÐšÐ Ð¡Ð¢Ð ÐÐ”ÐÐ•Ð¢. Ð’Ð¿Ð¸Ð·Ð´Ñƒ Ñ‚ÐµÐ¾Ñ€Ð¸ÑŽ. Ð¥Ð²Ð°Ñ‚Ð¸Ñ‚. ÐžÑ‚Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð¹
  Ð²ÐµÑÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð», ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð½Ð°ÐºÐ¾Ð¿Ð¸Ð» Ð´Ð¾ ÑÐ¸Ñ… Ð¿Ð¾Ñ€ â€“ Ð½Ð° Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐµ. ÐÐµ ÐµÐ±Ð»Ð°Ð½ÑŒ

  Ð˜ ÑÐµÐ¹Ñ‡Ð°Ñ. Ð¢Ñ‹, ÐµÐ±Ð»Ð°Ð½Ð° ÐºÑƒÑÐ¾Ðº, Ð·Ð½Ð°ÐµÑˆÑŒ, Ñ‡Ñ‚Ð¾ Ñ‚ÐµÐ±Ðµ Ð¾ÐºÐ°Ð·Ð°Ð»Ð¸ Ð·Ð½Ð°Ðº Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ, 
  Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸Ð² ÑÑ‚Ð°ÐºÐ°Ð½ Ñ Ð²Ð¾Ð´Ð¾Ð¹ Ñ€ÑÐ´Ð¾Ð¼. Ð¥ÑƒÐ»Ðµ Ñ‚Ñ‹ Ð±Ð»ÑÑ‚ÑŒ ÑÐ¸Ð´Ð¸ÑˆÑŒ, Ð±Ð°Ñ€Ð°Ð½Ð° Ñ‚Ñ‹ ÐºÑƒÑÐ¾Ðº?
  Ð§Ñ‚Ð¾ Ð±Ñ‹ ÑÐ´ÐµÐ»Ð°Ð» ÐœÑÑ‚ÑŒÑŽ ÐœÑÐºÐºÐ¾Ð½Ð°Ñ…Ðµ? Ð‘ÐµÐ½Ð´Ð¶Ð°Ð¼Ð¸Ð½ Ð¤Ñ€Ð°Ð½ÐºÐ»Ð¸Ð½? Ð”Ñ€ÑƒÐ³Ð¸Ðµ Ñ‚Ð²Ð¾Ð¸ ÐºÑƒÐ¼Ð¸Ñ€Ñ‹?
  ÐÐ• Ð‘Ð£Ð”Ð¬ Ð¨Ð«Ð”Ð—Ð•. Ð•Ð¡Ð›Ð˜ ÐŸÐžÐÐ˜ÐœÐÐ•Ð¨Ð¬, ÐšÐÐš Ð¡Ð”Ð•Ð›ÐÐ™Ð¢Ð¬ ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - ÐÐ•Ð£ÐšÐžÐ¡ÐÐ˜Ð¢Ð•Ð›Ð¬ÐÐž Ð”Ð•Ð›ÐÐ™.
  Ð¡ÐœÐ•Ð›ÐžÐ¡Ð¬ â€“ ÐÐ• ÐžÐ¢Ð¡Ð£Ð¢Ð¡Ð¢Ð’Ð˜Ð• Ð¡Ð¢Ð ÐÐ¥Ð, Ð ÐžÐ¡ÐžÐ—ÐÐÐÐ˜Ð• Ð¢ÐžÐ“Ðž, Ð§Ð¢Ðž Ð•Ð¡Ð¢Ð¬ Ð’Ð•Ð©Ð˜ Ð’ÐÐ–ÐÐ•Ð•, Ð§Ð•Ðœ Ð¡Ð¢Ð ÐÐ¥.
  


  ---- Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ 14 Ð°Ð²Ð³ÑƒÑÑ‚Ð°:

  ÐÐ°Ð¿Ð¸ÑÐ°Ð½Ð½Ð¾Ðµ Ð²Ñ‹ÑˆÐµ Ð±Ñ‹Ð»Ð¾ 4 Ð¼ÐµÑÑÑ†Ð° Ð½Ð°Ð·Ð°Ð´. Ð’ Ð¸Ñ‚Ð¾Ð³Ðµ Ñ Ð½Ðµ Ð¾Ñ‡ÐºÐ¾Ð½ÑƒÐ» â€“Â Ð¿Ð¾Ð´ÐºÐ°Ñ‚Ð¸Ð». Ð˜ Ð¼Ð¾Ñ Ð¶Ð¸Ð·Ð½ÑŒ
  Ñ€Ð°Ð´Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð°ÑÑŒ: Ñ Ñ€Ð°ÑÑÑ‚Ð°Ð»ÑÑ Ñ Ð›Ð¸Ð·Ð¾Ð¹, Ð½Ð°Ñ‡Ð°Ð» Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°Ñ‚ÑŒÑÑ Ñ ÐžÐ»ÐµÐ¹. Ð¢Ð°Ð¹Ð»Ð°Ð½Ð´ ðŸï¸
  ÐžÑ…ÑƒÐµÐ½Ð½Ñ‹Ð¹ Ð½ÐµÐ·Ð°Ð±Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ð¹ ÐºÑƒÑ€Ð¾Ñ€Ñ‚Ð½Ñ‹Ð¹ Ñ€Ð¾Ð¼Ð°Ð½. ÐœÐ½Ð¾Ð³Ð¾ Ð½Ð¾Ð²Ñ‹Ñ… Ð¾Ñ‰ÑƒÑ‰ÐµÐ½Ð¸Ð¹. Ð¡ÐµÐ¹Ñ‡Ð°Ñ ÐžÐ»Ñ Ð¶Ð¸Ð²Ñ‘Ñ‚ 
  Ñƒ Ð¼ÐµÐ½Ñ Ñ Ð Ð¾Ð·Ð¾Ð¹. ÐžÑ‰ÑƒÑ‚Ð¸Ð» ÐºÐ°ÐºÐ¾Ð²Ð¾ ÑÑ‚Ð¾ Ð¶Ð¸Ñ‚ÑŒ Ð¿Ð¾-ÑÐµÐ¼ÐµÐ¹Ð½Ð¾Ð¼Ñƒ Ñ Ñ€ÐµÐ±Ñ‘Ð½ÐºÐ¾Ð¼. Ð˜ Ð²ÑÑ‘ ÑÑ‚Ð¾ Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ
  Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ñ‚Ð¾Ð³Ð´Ð° ÑÐ¾Ð±Ñ€Ð°Ð» Ð²Ð¾Ð»ÑŽ Ð² ÐºÑƒÐ»Ð°Ðº Ð¸ Ð½Ðµ Ð¾Ñ‡ÐºÐ¾Ð½ÑƒÐ». Ð¡Ð¼ÐµÐ»Ð¾ÑÑ‚ÑŒ Ð²Ð¾Ð·Ð½Ð°Ð³Ñ€Ð°Ð¶Ð´Ð°ÐµÑ‚ÑÑ Ñ Ð»Ð¸Ñ…Ð²Ð¾Ð¹.

  Ð—Ð½Ð°Ð¹ Ð²Ð¿Ñ€ÐµÐ´ÑŒ: Ð¼Ð¸Ð½ÑƒÑ‚Ð° ÑÐ¼ÐµÐ»Ð¾ÑÑ‚Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¶Ð¸Ð·Ð½ÑŒ Ð½Ð° Ð³Ð¾Ð´Ñ‹ Ð²Ð¿ÐµÑ€Ñ‘Ð´. ÐžÐ½Ð¾ Ñ‚Ð¾Ð³Ð¾ ÑÑ‚Ð¾Ð¸Ñ‚. 

  Ð”Ñ€ÑƒÐ³Ð¾Ðµ Ð´ÐµÐ»Ð¾, Ñ‡Ñ‚Ð¾ ÐžÐ»Ñ Ð¾ÐºÐ°Ð·Ð°Ð»Ð°ÑÑŒ Ñ‚ÑƒÐ¿Ð°Ñ, Ñ ÐºÑƒÑ‡ÐµÐ¹ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ Ð¸ Ñ Ð¿Ñ€Ð¸Ñ†ÐµÐ¿Ð¾Ð¼. Ð Ñ 
  ÑÐµÐ¹Ñ‡Ð°Ñ Ð²ÑÐµ ÑƒÑÐ¸Ð»Ð¸Ñ Ð¿Ñ€Ð¸Ð»Ð°Ð³Ð°ÑŽ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ñ‹Ð³Ð½Ð°Ñ‚ÑŒ ÐµÑ‘ Ð½Ð°Ñ…ÑƒÐ¹ Ð¸Ð· Ð´Ð¾Ð¼Ð° :D 
 -->
